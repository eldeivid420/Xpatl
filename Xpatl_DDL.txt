create type tipo as enum('efectivo','debito','credito','credito proveedor');
create type estatus as enum('creado', 'pagado', 'entregado', 'cancelado');
create type rol as enum('admin', 'vendedor', 'cobrador', 'entregador');
CREATE TABLE public.usuario
(
   id INT GENERATED ALWAYS AS IDENTITY NOT NULL,
   username VARCHAR(45) NOT NULL,
   nombre varchar NOT NULL,
   pass VARCHAR NOT NULL,
   activo BOOL NOT NULL,
   rol rol NOT NULL,
   CONSTRAINT pk_usuario PRIMARY KEY(username)
);

CREATE TABLE public.venta
(
    id INT GENERATED ALWAYS AS IDENTITY NOT NULL,
    vendedor VARCHAR(40) NOT NULL,
    sub_id INT NOT NULL,
    tipo tipo DEFAULT NULL,
    estatus estatus DEFAULT 'creado',
    proveedor varchar(50),
    proveedor_notas varchar,
    descuento float,
    subtotal float,
    total float,
    fecha TIMESTAMP NOT NULL DEFAULT NOW(),
    CONSTRAINT pk_compra PRIMARY KEY(id),
    CONSTRAINT fk_usuario FOREIGN KEY(vendedor) REFERENCES public.usuario(username)
);

CREATE TABLE public.producto
(
    id INT GENERATED ALWAYS AS IDENTITY NOT NULL,
    nombre VARCHAR NOT NULL,
    precio float NOT NULL,
    precio_esp float NOT NULL,
    disponibles INT NOT NULL,
    sku varchar NOT NULL UNIQUE,
    estatus BOOL NOT NULL DEFAULT True,
    CONSTRAINT pk_producto PRIMARY KEY(sku)
);

CREATE TABLE public.producto_venta
(
    id INT GENERATED ALWAYS AS IDENTITY NOT NULL,
    producto VARCHAR NOT NULL,
    venta INT NOT NULL,
    CONSTRAINT fk_producto FOREIGN KEY (producto) REFERENCES public.producto(sku),
    CONSTRAINT fk_venta FOREIGN KEY (venta) REFERENCES public.venta(id)

);



CREATE TABLE public.comisiones
(
    id INT GENERATED ALWAYS AS IDENTITY NOT NULL,
    vendedor VARCHAR NOT NULL,
    monto float NOT NULL,
    pagado bool NOT NULL,
    fecha TIMESTAMP NOT NULL DEFAULT NOW(),
	pagado_en TIMESTAMP,
    CONSTRAINT pk_comision PRIMARY KEY(id),
    CONSTRAINT fk_usuario FOREIGN KEY(vendedor) REFERENCES public.usuario(username)
);

